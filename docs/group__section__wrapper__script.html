<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Leave Script Behind Document: The Wrapper Script for Shells</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Leave Script Behind Document<span id="projectnumber">&#160;Release Candidate 0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">The Wrapper Script for Shells</div></div>
</div><!--header-->
<div class="contents">
<p>In the shell settings, there is a script wrapper used for connecting the user-defined script with the LSB view. It contains several placeholders that will be replaced by real values before execution. The user-defined script is not sent to the shell process directly. Instead, the script wrapper with all placeholders substituted with real values, which includes the user-defined script, is the final script that will be sent to shell process to execute, and then the response from the script will be collected from the intermediate data file (if it's created during the final script execution) or the script output will be used for the response content (if the intermediate data file is not used).</p>
<p>The placeholders serve for different purpose during the shell script execution. The LSB application relies on them to get the script executed properly and have the responses collected and shared with other view controls in the same LSB view. </p><ul>
<li>
<b>Customized user script</b> - <b>[Mandatory]</b> this placeholder is used for including the user-defined script in the LSB view. Assuming the placeholder for the user-defined script is <code>%USER_SCRIPT%%</code>, if user wants to send the scripts defined in an LSB view directly to the shell process, user may set the script wrapper to contain this placeholder only, which means the script wrapper will be looking like <code>%USER_SCRIPT%%</code>. Though theoritically you can do it in this way, it's suggested not to do so, as the LSB application will lose the capability to get the output from your script properly. To get better understanding on this issue, please check the explanation for Intermediate data file below. </li>
<li>
<b>Intermediate data file</b> - <b>[Optional]</b> for many shells, there is no good way to convert script output in plain text into structured data. LSB provides this intermediate data file to capture all the outputs (must be in JSON format) from the user-defined script, and then the LSB will load and parse the data file to create structured data to be used in the LSB view. If the output from the user-defined script is not in JSON format, then the whole output will be recognized as a single string value. </li>
<li>
<b>First half of signature</b> and <b>Second half of signature</b> - <b>[Mandatory]</b> to detect the completion of the final script execution in the shell process, the LSB checks for a special flag in the script output. It first randomly generates a piece of signature data and splits it into two parts. The two parts are automatically assigned to two variables, i.e. the two signature placeholders, respectively, and then they are combined together to output the complete signature at the end of the wrapper script. When LSB detects the full signature in the shell output, it knows that the script execution reaches the end of the script. By splitting the signature into two parts, it ensures that no other place in the script could contain/output the full signature, preventing LSB from mistakenly thinking the script execution is completed before the actual end of the wrapper script. </li>
<li>
<b>Path to view file</b> - <b>[Optional]</b> this placeholder can be used in the wrapper script if it needs to access any file sitting in the same folder where the LSB view file is located. </li>
</ul>
<p>When the LSB receives a request to execute a piece of user-defined script, it loads the wrapper script and replaces all the placeholders with actual values. The resulting script is then sent to the shell process for execution, and the LSB continuously monitors the shell output for the full signature. When the full signature shows up in the shell output, the LSB recognizes that the script execution completes. It then attempts to load the intermediate data file, parse the result data from it, and use the result data to refresh the view content and/or update the output parameters of the view control. If the intermediate data file is not used, then LSB uses the captured shell output as a single string value as the response from the script. If the full signature is not detected before the script execution timeout, the LSB terminates the script execution, attempts to parse the result data or the shell output, and refreshes the view content accordingly. If failures are captured during script execution, an error message will be displayed and no data will be returned. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
